import spacy
import openai

# Load the spaCy model
nlp = spacy.load("en_core_web_sm")

def generate_scene_prompts(text):
    # Process the text with spaCy
    doc = nlp(text)

    # Initialize variables to keep track of scenes and prompts
    scenes = []
    current_scene = ""
    prompts = []

    for token in doc:
        # Check if the token is a period, which may indicate the end of a sentence or scene
        if token.text == ".":
            # If we have a current scene, add it to the list of scenes
            if current_scene:
                scenes.append(current_scene)
                current_scene = ""
        else:
            # Append the token to the current scene
            current_scene += token.text + " "

    # Generate prompts from the chronological scenes
    for i, scene in enumerate(scenes):
        prompt = f"Scene {i + 1}: {scene}"
        prompts.append(prompt)

    return prompts

# Example text with chronological scenes
# story_text = "Once upon a time, there was a forest. In the forest, there was a small cottage. Inside the cottage, a family lived happily."
# story_text = "Once upon a time there lived a poor widow and her son Jack. One day, Jack’s mother told him to sell their only cow. Jack went to the market and on the way he met a man who wanted to buy his cow. Jack asked, “What will you give me in return for my cow?” The man answered, “I will give you five magic beans!” Jack took the magic beans and gave the man the cow. But when he reached home, Jack’s mother was very angry. She said, “You fool! He took away your cow and gave you some beans!” She threw the beans out of the window. Jack was very sad and went to sleep without dinner. The next day, when Jack woke up in the morning and looked out of the window, he saw that a huge beanstalk had grown from his magic beans! He climbed up the beanstalk and reached a kingdom in the sky. There lived a giant and his wife. Jack went inside the house and found the giant’s wife in the kitchen. Jack said, “Could you please give me something to eat? I am so hungry!” The kind wife gave him bread and some milk. While he was eating, the giant came home. The giant was very big and looked very fearsome. Jack was terrified and went and hid inside. The giant cried, “Fee-fi-fo-fum, I smell the blood of an Englishman. Be he alive, or be he dead, I’ll grind his bones to make my bread!” The wife said, “There is no boy in here!” So, the giant ate his food and then went to his room. He took out his sacks of gold coins, counted them and kept them aside. Then he went to sleep. In the night, Jack crept out of his hiding place, took one sack of gold coins and climbed down the beanstalk. At home, he gave the coins to his mother. His mother was very happy and they lived well for sometime. Climbed the beanstalk and went to the giant’s house again. Once again, Jack asked the giant’s wife for food, but while he was eating the giant returned. Jack leapt up in fright and went and hid under the bed. The giant cried, “Fee-fifo-fum, I smell the blood of an Englishman. Be he alive, or be he dead, I’ll grind his bones to make my bread!” The wife said, “There is no boy in here!” The giant ate his food and went to his room. There, he took out a hen. He shouted, “Lay!” and the hen laid a golden egg. When the giant fell asleep, Jack took the hen and climbed down the beanstalk. Jack’s mother was very happy with him. After some days, Jack once again climbed the beanstalk and went to the giant’s castle. For the third time, Jack met the giant’s wife and asked for some food. Once again, the giant’s wife gave him bread and milk. But while Jack was eating, the giant came home. “Fee-fi-fo-fum, I smell the blood of an Englishman. Be he alive, or be he dead, I’ll grind his bones to make my bread!” cried the giant. “Don’t be silly! There is no boy in here!” said his wife. The giant had a magical harp that could play beautiful songs. While the giant slept, Jack took the harp and was about to leave. Suddenly, the magic harp cried, “Help master! A boy is stealing me!” The giant woke up and saw Jack with the harp. Furious, he ran after Jack. But Jack was too fast for him. He ran down the beanstalk and reached home. The giant followed him down. Jack quickly ran inside his house and fetched an axe. He began to chop the beanstalk. The giant fell and died. Jack and his mother were now very rich and they lived happily ever after."
#story_text = "Once upon a midnight dreary, while I pondered, weak and weary, Over many a quaint and curious volume of forgotten lore— While I nodded, nearly napping, suddenly there came a tapping, As of some one gently rapping, rapping at my chamber door. “’Tis some visitor,” I muttered, “tapping at my chamber door— Only this and nothing more.” Ah, distinctly I remember it was in the bleak December; And each separate dying ember wrought its ghost upon the floor. Eagerly I wished the morrow;—vainly I had sought to borrow From my books surcease of sorrow—sorrow for the lost Lenore— For the rare and radiant maiden whom the angels name Lenore— Nameless here for evermore. And the silken, sad, uncertain rustling of each purple curtain Thrilled me—filled me with fantastic terrors never felt before; So that now, to still the beating of my heart, I stood repeating “’Tis some visitor entreating entrance at my chamber door— Some late visitor entreating entrance at my chamber door;— This it is and nothing more.” Presently my soul grew stronger; hesitating then no longer, “Sir,” said I, “or Madam, truly your forgiveness I implore; But the fact is I was napping, and so gently you came rapping, And so faintly you came tapping, tapping at my chamber door, That I scarce was sure I heard you”—here I opened wide the door;— Darkness there and nothing more. Deep into that darkness peering, long I stood there wondering, fearing, Doubting, dreaming dreams no mortal ever dared to dream before; But the silence was unbroken, and the stillness gave no token, And the only word there spoken was the whispered word, “Lenore?” This I whispered, and an echo murmured back the word, “Lenore!”— Merely this and nothing more. Back into the chamber turning, all my soul within me burning, Soon again I heard a tapping somewhat louder than before. “Surely,” said I, “surely that is something at my window lattice; Let me see, then, what thereat is, and this mystery explore— Let my heart be still a moment and this mystery explore;— ’Tis the wind and nothing more!” Open here I flung the shutter, when, with many a flirt and flutter, In there stepped a stately Raven of the saintly days of yore; Not the least obeisance made he; not a minute stopped or stayed he; But, with mien of lord or lady, perched above my chamber door— Perched upon a bust of Pallas just above my chamber door— Perched, and sat, and nothing more. Then this ebony bird beguiling my sad fancy into smiling, By the grave and stern decorum of the countenance it wore, “Though thy crest be shorn and shaven, thou,” I said, “art sure no craven, Ghastly grim and ancient Raven wandering from the Nightly shore— Tell me what thy lordly name is on the Night’s Plutonian shore!” Quoth the Raven “Nevermore.” Much I marvelled this ungainly fowl to hear discourse so plainly, Though its answer little meaning—little relevancy bore; For we cannot help agreeing that no living human being Ever yet was blessed with seeing bird above his chamber door— Bird or beast upon the sculptured bust above his chamber door, With such name as “Nevermore.” But the Raven, sitting lonely on the placid bust, spoke only That one word, as if his soul in that one word he did outpour. Nothing farther then he uttered—not a feather then he fluttered— Till I scarcely more than muttered “Other friends have flown before— On the morrow he will leave me, as my Hopes have flown before.” Then the bird said “Nevermore.” Startled at the stillness broken by reply so aptly spoken, “Doubtless,” said I, “what it utters is its only stock and store Caught from some unhappy master whom unmerciful Disaster Followed fast and followed faster till his songs one burden bore— Till the dirges of his Hope that melancholy burden bore Of ‘Never—nevermore’.” But the Raven still beguiling all my fancy into smiling, Straight I wheeled a cushioned seat in front of bird, and bust and door; Then, upon the velvet sinking, I betook myself to linking Fancy unto fancy, thinking what this ominous bird of yore— What this grim, ungainly, ghastly, gaunt, and ominous bird of yore Meant in croaking “Nevermore.” This I sat engaged in guessing, but no syllable expressing To the fowl whose fiery eyes now burned into my bosom’s core; This and more I sat divining, with my head at ease reclining On the cushion’s velvet lining that the lamp-light gloated o’er, But whose velvet-violet lining with the lamp-light gloating o’er, She shall press, ah, nevermore! Then, methought, the air grew denser, perfumed from an unseen censer Swung by Seraphim whose foot-falls tinkled on the tufted floor. “Wretch,” I cried, “thy God hath lent thee—by these angels he hath sent thee Respite—respite and nepenthe from thy memories of Lenore; Quaff, oh quaff this kind nepenthe and forget this lost Lenore!” Quoth the Raven “Nevermore.” “Prophet!” said I, “thing of evil!—prophet still, if bird or devil!— Whether Tempter sent, or whether tempest tossed thee here ashore, Desolate yet all undaunted, on this desert land enchanted— On this home by Horror haunted—tell me truly, I implore— Is there—is there balm in Gilead?—tell me—tell me, I implore!” Quoth the Raven “Nevermore.” “Prophet!” said I, “thing of evil!—prophet still, if bird or devil! By that Heaven that bends above us—by that God we both adore— Tell this soul with sorrow laden if, within the distant Aidenn, It shall clasp a sainted maiden whom the angels name Lenore— Clasp a rare and radiant maiden whom the angels name Lenore.” Quoth the Raven “Nevermore.” “Be that word our sign of parting, bird or fiend!” I shrieked, upstarting— “Get thee back into the tempest and the Night’s Plutonian shore! Leave no black plume as a token of that lie thy soul hath spoken! Leave my loneliness unbroken!—quit the bust above my door! Take thy beak from out my heart, and take thy form from off my door!” Quoth the Raven “Nevermore.” And the Raven, never flitting, still is sitting, still is sitting On the pallid bust of Pallas just above my chamber door; And his eyes have all the seeming of a demon’s that is dreaming, And the lamp-light o’er him streaming throws his shadow on the floor; And my soul from out that shadow that lies floating on the floor Shall be lifted—nevermore!"
story_text = "At the very top of the hay-mow in the barn, the Speckled Hen had made her nest, and each day for twelve days she had laid in it a pretty white egg. The Speckled Hen had made her nest in this out-of-the-way place so that no one would come to disturb her, as it was her intention to sit upon the eggs until they were hatched into chickens. Each day, as she laid her eggs, she would cackle to herself; saying, 'This will in time be a beautiful chick, with soft, fluffy down all over its body and bright little eyes that will look at the world in amazement. It will be one of my children, and I shall love it dearly. 'She named each egg, as she laid it, by the name she should call it when a chick, the first one being Cluckety-Cluck, and the next Cadaw-Cut, and so on; and when she came to the twelfth egg she called it Humpty Dumpty. This twelfth egg was remarkably big and white and of a very pretty shape, and as the nest was now so full she laid it quite near the edge. And then the Speckled Hen, after looking proudly at her work, went off to the barnyard, clucking joyfully, in search of something to eat. When she had gone, Cluckety-Cluck, who was in the middle of the nest and the oldest egg of all, called out, angrily, It 's getting crowded in this nest; move up there, some of you fellows! And then he gave CadawCut, who was above him, a kick. I can't move unless the others do; they 're crowding me down! said Cadaw-Cut; and he kicked the egg next above him. And so they continued kicking one another and rolling around in the nest until one kicked Humpty Dumpty, and as he lay on the edge of the nest he was kicked out and rolled down the hay-mow until he came to a stop near the very bottom. Humpty did not like this very well, but he was a bright egg for one so young, and after he had recovered from his shaking up he began to look about to see where he was. The barn door was open, and he caught a glimpse of trees and hedges, and green grass with a silvery brook running through it. And he saw the waving grain and the tasselled maize and the sunshine flooding it all. The scene was very enticing to the young egg, and Humpty at once resolved to see something of this great world before going back to the nest. He began to make his way carefully through the hay, and was getting along fairly well when he heard a voice say, Where are you going? Humpty looked around and found he was beside a pretty little nest in which was one brown egg. Did you speak? he asked. Yes, replied the brown egg; I asked where you were going. Who are you? enquired Humpty; do you belong in our nest? Oh, no! answered the brown egg; my name is Coutchie-Coulou, and the Black Bantam laid me about an hour ago. Oh, said Humpty proudly; I belong to the Speckled Hen myself." "Do you, indeed! returned Coutchie-Coulou. I saw her go by a little while ago, and she 's much bigger than the Black Bantam." "Yes, and I 'm much bigger than you, replied Humpty. But I 'm going out to see the world, and if you like to go with me I 'll take good care of you." "Is n't it dangerous for eggs to go about all by themselves? asked Coutchie, timidly. Perhaps so, answered Humpty; but it 's dangerous in the nest, too; my brothers might have smashed me with their kicking. However, if we are careful we can't come to much harm; so come along, little one, and I 'll look after you. Coutchie-Coulou gave him her hand while he helped her out of the nest, and together they crept over the hay until they came to the barn floor. They made for the door at once, holding each other by the hand, and soon came to the threshold, which appeared very high to them. We must jump, said Humpty. I 'm afraid! cried Coutchie-Coulou. And I declare! there 's my mother's voice clucking, she 's coming this way. Then hurry! said Humpty. And do not tremble so or you will get yourself all mixed up; it does n't improve eggs to shake them. We will jump but take care not to bump against me or you may break my shell. Now,--one,--two,--three! They held each other's hand and jumped, alighting safely in the roadway. Then, fearing their mothers would see them, Humpty ran as fast as he could go until he and Coutchie were concealed beneath a rosebush in the garden. I 'm afraid we 're bad eggs, gasped Coutchie, who was somewhat out of breath. Oh, not at all, replied Humpty; we were laid only this morning, so we are quite fresh. But now, since we are in the world, we must start out in search of adventure. Here is a roadway beside us which will lead us somewhere or other; so come along, Coutchie-Coulou, and do not be afraid. The brown egg meekly gave him her hand, and together they trotted along the roadway until they came to a high stone wall, which had sharp spikes upon its top. It seemed to extend for a great distance, and the eggs stopped and looked at it curiously. I 'd like to see what is behind that wall, said Humpty, but I do n't think we shall be able to climb over it. No, indeed, answered the brown egg, but just before us I see a little hole in the wall, near the ground; perhaps we can crawl through that. They ran to the hole and found it was just large enough to admit them. So they squeezed through very carefully, in order not to break themselves, and soon came to the other side. They were now in a most beautiful garden, with trees and bright-hued flowers in abundance and pretty fountains that shot their merry sprays far into the air. In the center of the garden was a great palace, with bright golden turrets and domes, and many windows that glistened in the sunshine like the sparkle of diamonds. Richly dressed courtiers and charming ladies strolled through the walks, and before the palace door were a dozen prancing horses, gaily caparisoned, awaiting their riders. It was a scene brilliant enough to fascinate anyone, and the two eggs stood spellbound while their eyes feasted upon the unusual sight. See! whispered Coutchie-Coulou, there are some birds swimming in the water yonder. Let us go and look at them, for we also may be birds someday.   True,  answered Humpty,  but we are just as likely to be omelets or angel's-food. Still, we will have a look at the birds.  So they started to cross the drive on their way to the pond, never noticing that the King and his courtiers had issued from the palace and were now coming down the drive riding upon their prancing steeds. Just as the eggs were in the middle of the drive the horses dashed by, and Humpty, greatly alarmed, ran as fast as he could for the grass. Then he stopped and looked around, and behold! There was poor Coutchie-Coulou crushed into a shapeless mass by the hoof of one of the horses, and her golden heart was spreading itself slowly over the white gravel of the driveway! Humpty sat down upon the grass and wept grievously, for the death of his companion was a great blow to him. And while he sobbed, a voice said to him,  What is the matter, little egg?  Humpty looked up, and saw a beautiful girl bending over him.  One of the horses has stepped upon Coutchie-Coulou,  he said;  and now she is dead, and I have no friend in all the world.  The girl laughed.  Do not grieve,  she said,  for eggs are but short-lived creatures at best, and Coutchie-Coulou has at least died an honorable death and saved herself from being fried in a pan or boiled in her own shell. So cheer up, little egg, and I will be your friend--at least so long as you remain fresh. A stale egg I never could abide.   I was laid only this morning,  said Humpty, drying his tears,  so you need have no fear. But do not call me 'little egg,' for I am quite large, as eggs go, and I have a name of my own.   What is your name?  asked the Princess.  It is Humpty Dumpty,  he answered, proudly.  And now, if you will really be my friend, pray show me about the grounds, and through the palace; and take care I am not crushed.  So the Princess took Humpty in her arms and walked with him all through the grounds, letting him see the fountains and the golden fish that swam in their waters, the beds of lilies and roses, and the pools where the swans floated. Then she took him into the palace, and showed him all the gorgeous rooms, including the King's own bed-chamber and the room where stood the great ivory throne. Humpty sighed with pleasure.  After this,  he said,  I am content to accept any fate that may befall me, for surely no egg before me ever saw so many beautiful sights.   That is true,  answered the Princess;  but now I have one more sight to show you which will be grander than all the others; for the King will be riding home shortly with all his horses and men at his back, and I will take you to the gates and let you see them pass by.   Thank you,  said Humpty. So she carried him to the gates, and while they awaited the coming of the King the egg said,  Put me upon the wall, Princess, for then I be able to see much better than in your arms.   That is a good idea,  she answered;  but you must be careful not to fall.  Then she sat the egg gently upon the top of the stone wall, where there was a little hollow; and Humpty was delighted, for from his elevated perch he could see much better than the Princess herself.  Here they come!  he cried; and, sure enough, the King came riding along the road with many courtiers and soldiers and vassals following in his wake, all mounted upon the finest horses the kingdom could afford. As they came to the gate and entered at a brisk trot, Humpty, forgetting his dangerous position, leaned eagerly over to look at them. The next instant the Princess heard a sharp crash at her side, and, looking downward, perceived poor Humpty Dumpty, who lay crushed and mangled among the sharp stones where he had fallen. The Princess sighed, for she had taken quite a fancy to the egg; but she knew it was impossible to gather it up again or mend the matter in any way, and therefore she returned thoughtfully to the palace. Now it happened that upon this evening several young men of the kingdom, who were all of high rank, had determined to ask the King for the hand of the Princess; so they assembled in the throne room and demanded that the King choose which of them was most worthy to marry his daughter. The King was in a quandary, for all the suitors were wealthy and powerful, and he feared that all but the one chosen would become his enemies. Therefore he thought long upon the matter, and at last said,  Where all are worthy it is difficult to decide which most deserves the hand of the Princess. Therefore I propose to test your wit. The one who shall ask me a riddle I cannot guess, can marry my daughter.  At this the young men looked thoughtful, and began to devise riddles that his Majesty should be unable to guess. But the King was a shrewd monarch, and each one of the riddles presented to him he guessed with ease. Now there was one amongst the suitors whom the Princess herself favored, as was but natural. He was a slender, fair-haired youth, with dreamy blue eyes and a rosy complexion, and although he loved the Princess dearly he despaired of finding a riddle that the King could not guess. But while he stood leaning against the wall the Princess approached him and whispered in his ear a riddle she had just thought of. Instantly his face brightened, and when the King called,  Now, Master Gracington, it is your turn,  he advanced boldly to the throne.  Speak your riddle, sir, said the King, gaily; for he thought this youth would also fail, and that he might therefore keep the Princess by his side for a time longer. But Master Gracington, with downcast eyes, knelt before the throne and spoke in this wise: This is my riddle, oh King: Humpty Dumpty sat on a wall, Humpty Dumpty had a great fall All the King's horses And all the King's men Cannot put Humpty together again! Read me that, sire, an you will! The King thought earnestly for a long time, and he slapped his head and rubbed his ears and walked the floor in great strides; but guess the riddle he could not. You are a humbug, sir! he cried out at last; there is no answer to such a riddle. You are wrong, sire, answered the young man; Humpty Dumpty was an egg.Why did I not think of that before! exclaimed the King; but he gave the Princess to the young man to be his bride, and they lived happily together. And thus did Humpty Dumpty, even in his death, repay the kindness of the fair girl who had shown him such sights as an egg seldom sees. "

prompts = generate_scene_prompts(story_text)
for prompt in prompts:
    print(prompt)

#------------------------------IMAGE GENERATION STUFF
# Set your OpenAI API key
openai.api_key = "PUT KEY HERE"

def generate_image_prompts_using_gpt3(scenes):
    prompts = []

    for i, scene in enumerate(scenes):
        # Generate context-aware prompts using GPT-3
        prompt = f"Please make an AI image generation prompt for the following scene in the Raven by edgar allen poe {scene}; to make the characters consistent, everytime the Raven is mentioned, describe the Raven as black with a yellow beak."
        response = openai.Completion.create(
            engine="text-davinci-002",
            prompt=prompt,
            max_tokens=50  # Adjust this for desired prompt length
        )
        image_prompt = response.choices[0].text.strip()
        prompts.append(image_prompt)

    return prompts

# List of scenes from your story
scenes = prompts

image_prompts = generate_image_prompts_using_gpt3(scenes)

for i, prompt in enumerate(image_prompts):
    print(f"Image Prompt {i + 1}: {prompt}")

    '''
    Image Prompt 1: Scene:

Once upon a midnight dreary, while I pondered, weak and weary, over many a quaint and curious volume of forgotten lore- while I nodded, nearly napping, suddenly there came a tapping, as of
Image Prompt 2: The visitor is tapping at the door of my chamber, and I can only see a black shadow with a yellow beak.
Image Prompt 3: The protagonist is sitting in a dark room, with only a fire to light it. He is thinking about the Raven, which is black with a yellow beak.       
Image Prompt 4: The Raven is black with a yellow beak and is perched on a statue of a maiden.
Image Prompt 5: The black Raven with its yellow beak perched atop the doorframe, looking into the room with its beady eyes. The silken, sad, uncertain rustling of the purple curtains filled the Raven with fantastic terrors never felt before
Image Prompt 6: The bird was equally black, with a yellow beak. Immediately upon my opening the door, it flew in with a loud caw, and alighted on the back of my easy-chair.
Image Prompt 7: The AI image generation prompt for the scene would be to create an image of the Raven as a black bird with a yellow beak.
Image Prompt 8: The Raven enters the room and looks around, noticing theTap, Tap, Tapping noise coming from the window. It cautiously walks over to the window to investigate. Once at the window, the Raven sees a large, black bird with a
Image Prompt 9: The Raven perched atop the bust of Pallas was black as midnight, with a beak as yellow as the moon. It sat there for a moment, flapping its wings softly in the breeze, before preening itself with its beak
Image Prompt 10: In the scene, the Raven is described as black with a yellow beak. Everytime the Raven is mentioned, describe the Raven as black with a yellow beak.
Image Prompt 11: The Raven looks down upon the scene below with a critical eye, wondering how these humans could ever hope to understand its great and ancient wisdom. It caws once, a sound that echoes in the stillness of the night, and takes wing
Image Prompt 12: The Raven is black with a yellow beak and is sitting on a bust in a room that is dark and candles are the only source of light. The Raven is speaking to the person in the room and the only thing that is heard is
Image Prompt 13: The Raven sat upon the bust of Pallas, and everytime it was mentioned, it was black with a yellow beak.
Image Prompt 14: The Raven is black with a yellow beak and nevermore says the word “nevermore”.
Image Prompt 15: The Raven is a black bird with a yellow beak. It is sitting on a tree branch in a dark forest.
Image Prompt 16: The yellow beak of the Raven sets it apart from other birds and gives it an ominous feeling.
Image Prompt 17: The room grew darker and more perfumed as the Raven glided in, its black feathers shiny in the lamplight. It fixed its yellow beak on me and stared deep into my soul. I could feel its cool breath on my
Image Prompt 18: A black raven with a yellow beak sits on a raven perch in a bleak and dreary castle. The raven looks at the speaker with beady eyes and caws softly, "Nevermore."
Image Prompt 19: The Raven is a black bird with a yellow beak. It is perched on a branch in a tree, looking down at the narrator with its beady eyes.
Image Prompt 20: The Raven cawed in response, "Nevermore."
Image Prompt 21: The Raven is always black with a yellow beak in this scene.
Image Prompt 22: “Be that word our sign of parting, bird or fiend!” I shrieked, upstarting – “Get thee back into the tempest and the Night’s Plutonian shore! Leave no black'''